---
title: "talleR de coloR"
author: "pedro.concejerocerezo@telefonica.com"
date: "Thursday, October 09, 2014"
output: word_document
---

LO PRIMERO TEMAS PENDIENTES:


- Nos concentramos en dos ejemplos:
    - 1 gráfico con demasiado color (mira la locura que me llega a diario, adjunta). Lo puedo replicar perfect.
    - 1 mapa heatmap paro España con R. *SE LO HE PEDIDO A GRUPO R A VER SI HAY UNO YA HECHO*
    Estos días de atrás ha salido un ejemplo interesante de heatmaps: http://elpais.com/elpais/2014/09/29/media/1412009164_993167.html

- Los números del color y su representación visual (*mira la preciosa librería colortools, modelo HSV*:
    - Matiz - hue
    - Saturación - saturation
    - Brillo - brightness o lightness

- Buscar en R el html con los 216 web safe color palette (*ENCONTRADA*)

- Pasar a la web safe color palette la dichromat 

- Manejar la transparencia del color - qué es el canal alfa (*ESTÁ EN LA COLORTOOLS*)

- Revisar esto: http://www.jedsoft.org/fun/complex/fztopng.html

- *JOSE PUEDES LOCALIZAR EL WORD DE TU ARTÍCULO: LO FUSILAMOS AQUÍ DIRECTAMENTE*



```{r}

# Inicialización
# Comprueba si están y si no instala librerías

if ("sos" %in% row.names(installed.packages())  == FALSE) install.packages("sos", dependencies = T)
if ("colortools" %in% row.names(installed.packages())  == FALSE) install.packages("colortools", dependencies = T)
if ("dichromat" %in% row.names(installed.packages())  == FALSE) install.packages("dichromat", dependencies = T)

dichromat
# Cargamos librerías que vamos a usar
library(colortools)
library(sos)
library(dichromat)

```


OBJETIVOS DE ESTE DOCUMENTO
========================================================

Recopilamos la documentación necesaria para el talleR de coloR dentro de las jornadas R-hispano 2014.

Resumen

El color es una más de entre las posibles características que pueden convertir un gráfico, una visualización, un sistema interactivo de análisis de datos en algo eficaz y atractivo o por el contrario hacer que esa misma visualización sea poco agradable, o, en algunos casos, más confusa que si se utilizan otras características visuales.
La disponibilidad actual de sistemas para manejar con práctica total libertad el color en las visualizaciones (por ejemplo en pantallas o proyectores) o impresiones no ha ido acompañada de recomendaciones sobre cómo optimizar el uso del mismo. De hecho, muchas tareas de manejo de los colores han pasado de auténticos expertos (por ejemplo diseñadores gráficos y técnicos de impresión) directamente a los generadores de los gráficos, con el riesgo de que una herramienta potentísima de comunicación no sea utilizada de la mejor manera.
En el mundo R hay multitud de tutoriales, guías, publicaciones de todo tipo para manejar el color desde un punto de vista técnico. De hecho, R es probablemente el entorno más potente para gestionar el color en un sistema informático dedicado al análisis de datos del que dispone un investigador en estos momentos. Sin embargo es difícil encontrar recomendaciones sobre el uso eficaz del color basadas en criterios científicos y ergonómicos.
La visión del color por los humanos es un campo multidisciplinar bien conocido que ha generado un amplio conocimiento, tanto desde el punto de vista científico como tecnológico. Nuestra propuesta es desarrollar un taller para trasladar este conocimiento a los expertos en R que desarrollan visualizaciones, de cualquier tipo, desde simples gráficos estáticos en una pantalla o proyector modernos, a gráficos
interactivos en dispositivos móviles o impresiones -en este último caso con una simplificación fundamental, porque no podremos abordar la impresión profesional propiamente dicha.

*_(a partir de aquí añadido)_*
Trabajaremos con ejemplos de gráficos que requieren color, como los heatmaps, y otros en los que el color es una característica adicional.
Manejaremos entre otras las librerías R
- RColorBrewer http://cran.r-project.org/web/packages/RColorBrewer/index.html (junto con maravilloso sitio http://colorbrewer2.org/)
- dichromat http://cran.r-project.org/web/packages/dichromat/index.html (daltonismo y ceguera color)



DOCUMENTACIÓN DISPONIBLE EN INTERNET Y QUE USAREMOS EN EL TALLER
- esencial pero muy complejo http://www.research.ibm.com/people/l/lloydt/color/color.HTM
- Tabla completa de colores y nombres en R http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf
- (*Mirar esto, es bueno pero incompleto*) http://www.stat.ubc.ca/~jenny/STAT545A/block14_colors.html
- http://www.datanalytics.com/2013/12/09/gradientes-e-ilusiones-opticas/
- Using color in R http://research.stowers-institute.org/efg/Report/UsingColorInR.pdf
- http://research.stowers-institute.org/efg/R/Color/Chart/index.htm
- Color Schemes for Scientific Graphs http://geog.uoregon.edu/datagraphics/color_scales.htm
- Color blindness http://www.efg2.com/Lab/Library/Color/index.html
- ciencia del color http://www.efg2.com/Lab/Library/Color/Science.htm
- color y ordenadores (inc. web safe) http://www.efg2.com/Lab/Library/Color/AndComputers.htm
- qué maravilla: tabla completa de colores http://research.stowers-institute.org/efg/R/Color/Chart/ColorChart.pdf




POR QUÉ R ES EL MEJOR SISTEMA ACTUAL (EN CAMPO ESTADÍSTICA) PARA MANEJO DE COLOR
========================================================

Veamos qué librerías contienen color (sos levanta una página html fuera de RStudio, con enlaces a la documentación de las funciones encontradas)


```{r}

sos::findFn("{color}")


```

Hay 359 funciones en 158 paquetes CRAN para estudiar o manejar color en R.

Tenemos por ejemplo la librería colorscience

http://finzi.psych.upenn.edu/R/library/colorscience/html/00Index.html

y la colortools
http://gastonsanchez.com/colortools/

colortools is an R package designed to help users generate color schemes and color palettes. It provides a number of handy functions that will allow to select and play with colors in an HSV (hue, saturation, value) color model. 

La librería colortools es fascinante. Por ejemplo, podemos hacer ruedas de color con un número variable de "gajos" o colores en la escala entre los extremos con la función wheel:

```{r}

colortools::wheel("blue", num = 6)

colortools::wheel("red", num = 12)

colortools::wheel("yellow", num = 24)

```

La función colortools::adjacent permite generar esquemas de color que están próximos unos a otros. La librería avisa "estos colores normalmente encajan bien y permiten crear diseños confortables". Se genera una rueda de 12 colores, separado cada uno de ellos 30 grados.

```{r}

colortools::adjacent("blue")

colortools::adjacent("green")

```

La función colortools::anagrams reordenan los pares de letras de un hexadecimal para formar otro color. Devuelve una lista de códigos de color. Luego se pueden representar con la función pizza


```{r}

ana_azul <- colortools::anagrams("cadetblue1")

pizza(ana_azul)

```


La función colortools::complementary permite formar esquemas de colores opuestos. Se trata de maximizar el contraste entre colores. Este efecto hay que usarlo con cautela.

```{r}

colortools::complementary("blue")

colortools::complementary("green")

colortools::complementary("red")


```

colortools::pals permite mostrar los colores de una paleta, y las paletas incluidas en la librería

```{r}

colortools::pals()

colortools::pals("ocean")

pizza(colortools::pals("ocean"))

wheel(colortools::pals("ocean")[1])
```

La función colortools::sequential permite obtener una secuencia de colores con números fijos de saturación, valor del color o alfa para un modelo de color HSV.

```{r}

colortools::sequential("blue")

colortools::sequential("orange")

colortools::sequential("orange", fun = "sqrt")

colortools::sequential("orange", fun = "log")

colortools::sequential("orange", 10, what = "value", s = 0.7, alpha = 0.5, fun = "log")

```

colortools::splitComp usa los dos colores adyacentes a sus complemento. Tiene el mismo contraste visual fuerte que el esquema complementario pero se supone que genera menos tensión.


```{r}

colortools::splitComp("blue")

```


Las funciones triadic, tetradic y square permiten representar colores con una distancia equivalente en la rueda de color, con 3, 4 (en dos pares complementarios), y 4 colores espaciados por igual, respectivamente

```{r}

triadic("blue")

tetradic("blue")

square("blue")

```


Una introducción 

1. Color: física y psicofísica
========================================================

- por qué color no debe ser única clave

2. Percepción del color
========================================================

EN EL COLOR TODO ES EL CONTEXTO
- algunas ilusiones chulas color, constancia y contraste color

3. Memoria y color
========================================================

    - baja capacidad de memoria para color -demostración con ejemplos
    - baja discriminación fina de matices de color
    - alternativas o mejor dicho otras características visuales además del color

4. Recomendaciones para el uso del color en visualización
========================================================

Escalas de color (RBrewer, color brewer)




RColorBrewer

Most of us are pretty lousy at choosing colors and it's easy to spend too much time fiddling with them. Cynthia Brewer, a geographer and color specialist, has created sets of colors for print and the web and they are available in the add-on package RColorBrewer. You will need to install and load this package to use.

#install.packages("RColorBrewer")
library(RColorBrewer)

Let's look at all the associated palettes.

display.brewer.all()


APENDICE

(de la maravillosa página http://research.stowers-institute.org/efg/R/Color/Chart/index.htm)

The following R code produces the "R Colors" graphic shown at the top of this page (using TextContrastColor defined above):


```{r}
   # 1a. Plot matrix of R colors, in index order, 25 per row.
    # This example plots each row of rectangles one at a time.
    colCount <- 25 # number per row
    rowCount <- 27

    plot( c(1,colCount), c(0,rowCount), type="n", ylab="", xlab="",
      axes=FALSE, ylim=c(rowCount,0))
    title("R colors")

    for (j in 0:(rowCount-1))
    {
      base <- j*colCount
      remaining <- length(colors()) - base
      RowSize <- ifelse(remaining < colCount, remaining, colCount)
      rect((1:RowSize)-0.5,j-0.5, (1:RowSize)+0.5,j+0.5,
        border="black",
        col=colors()[base + (1:RowSize)])
      text((1:RowSize), j, paste(base + (1:RowSize)), cex=0.7,
        col=TextContrastColor[base + (1:RowSize)])
    }


```

Alphabetical order is not necessarily a good way to find similar colors.  The RGB values of each of the colors() was converted to hue-saturation-value (HSV) and then sorted by HSV.  This approach groups colors of the same "hue" together a bit better.  Here's the code and graphic produced:


```{r}

    # 1b. Plot matrix of R colors, in "hue" order, 25 per row.
    # This example plots each rectangle one at a time.
    RGBColors <- col2rgb(colors()[1:length(colors())])
    HSVColors <- rgb2hsv( RGBColors[1,], RGBColors[2,], RGBColors[3,],
                 maxColorValue=255)
    HueOrder <- order( HSVColors[1,], HSVColors[2,], HSVColors[3,] )

    plot(0, type="n", ylab="", xlab="",
    axes=FALSE, ylim=c(rowCount,0), xlim=c(1,colCount))

    title("R colors -- Sorted by Hue, Saturation, Value")

    for (j in 0:(rowCount-1))
    {
      for (i in 1:colCount)
      {
       k <- j*colCount + i
       if (k <= length(colors()))
       {
        rect(i-0.5,j-0.5, i+0.5,j+0.5, border="black", col=colors()[ HueOrder[k] ])
        text(i,j, paste(HueOrder[k]), cex=0.7, col=TextContrastColor[ HueOrder[k] ])
       }
      }
    }


```

While the color matrices above are useful, a more useful display would include a rectangular area showing the color, the color index, the color name, and the RGB values, both in hexadecimal, which is often used in web pages.

The code for this is a bit tedious -- see Item #2 in the ColorChart.R code for complete details. Here is the first page of the Chart of R colors. 

```{r}
# efg, Stowers Institute for Medical Research
# efg's Research Notes:
#   http://research.stowers-institute.org/efg/R/Color/Chart
#
# 6 July 2004.  Modified 23 May 2005.

pdf("ColorChart.pdf", width=6, height=10)

# save to reset at end
oldparameters <- par(mar=c(1,1,2,1), mfrow=c(2,1))

# Be cautious in case definition of "colors" changes.
# Use some hard-coded constants since this is not expected
# to change.
stopifnot(length(colors()) == 657)

# 0. Setup

# For a given color, define a text color that will have good contrast.
#   Examples:
#     > SetTextContrastColor("white")
#     [1] "black"
#     > SetTextContrastColor("black")
#     [1] "white"
#     > SetTextContrastColor("red")
#     [1] "white"
#     > SetTextContrastColor("yellow")
#     [1] "black"
SetTextContrastColor <- function(color)
{
  ifelse( mean(col2rgb(color)) > 127, "black", "white")
}

# Define this array of text contrast colors that correponds to each
# member of the colors() array.
TextContrastColor <- unlist( lapply(colors(), SetTextContrastColor) )


# 1a. Plot matrix of R colors, in index order, 25 per row.
# This example plots each row of rectangles one at a time.
colCount <- 25  # number per row
rowCount <- 27

plot( c(1,colCount), c(0,rowCount), type="n", ylab="", xlab="",
     axes=FALSE, ylim=c(rowCount,0))
title("R colors")
mtext("http://research.stowers-institute.org/efg/R/Color/Chart",
      cex=0.6)

for (j in 0:(rowCount-1))
{
  base <- j*colCount
  remaining <- length(colors()) - base
  RowSize <- ifelse(remaining < colCount, remaining, colCount)
  rect((1:RowSize)-0.5,j-0.5, (1:RowSize)+0.5,j+0.5,
    border="black",
    col=colors()[base + (1:RowSize)])
  text((1:RowSize), j, paste(base + (1:RowSize)), cex=0.7,
       col=TextContrastColor[base + (1:RowSize)])
}

# 1b.  Plot matrix of R colors, in "hue" order, 25 per row.
# This example plots each rectangle one at a time.
RGBColors <- col2rgb(colors()[1:length(colors())])
HSVColors <- rgb2hsv( RGBColors[1,], RGBColors[2,], RGBColors[3,], maxColorValue=255)
HueOrder  <- order( HSVColors[1,], HSVColors[2,], HSVColors[3,] )

plot(0, type="n", ylab="", xlab="",
     axes=FALSE, ylim=c(rowCount,0), xlim=c(1,colCount))

title("R colors -- Sorted by Hue, Saturation, Value")

for (j in 0:(rowCount-1))
{
  for (i in 1:colCount)
  {
    k <- j*colCount + i
    if (k <= length(colors()))
    {
      rect(i-0.5,j-0.5, i+0.5,j+0.5, border="black", col=colors()[ HueOrder[k] ])
      text(i,j, paste(HueOrder[k]), cex=0.7, col=TextContrastColor[ HueOrder[k] ])
    }
  }
}


# 2. Create 7-page color chart showing rectangle block of color, along with
# index, color name, and RGB constants in hex and decimal.

# Define string vector of RGB hex and decimal constants for given color
# as a string.
#   Example:
#     > GetColorHexAndDecimal("yellow")
#     [1] "#FFFF00   255 255   0"
GetColorHexAndDecimal <- function(color)
{
  c <- col2rgb(color)
  sprintf("#%02X%02X%02X   %3d %3d %3d", c[1],c[2],c[3], c[1], c[2], c[3])
}

# Restore, change and save graphics parameters
par(oldparameters)
oldparameters <- par(mar=c(1,1,1,1))

# Prepare text vectors to be displayed, in addition to color names.
index <- paste(1:length(colors()))
HexAndDec <- unlist( lapply(colors(), GetColorHexAndDecimal) )

PerColumn <- 50
PerPage   <- 2*PerColumn

# Plot a column of color rectangles at a time for each page.
for (page in 1: (trunc( (length(colors()) + (PerPage-1)) / PerPage) )  )
{

  plot(0, type="n", ylab="", xlab="",
       axes=FALSE, ylim=c(PerColumn,0), xlim=c(0,1))
  title("R colors")
  mtext(paste("page ", page), SOUTH<-1, adj=1, line=-1)

  base <- PerPage*(page-1)

  # Column 1
  remaining <- length(colors()) - base
  ColumnSize <- ifelse(remaining < PerColumn, remaining, PerColumn)

  rect(0.00, 0:(ColumnSize-1),
       0.49, 1:ColumnSize,
       border="black",
       col=colors()[(base+1):(base+ColumnSize)])
  text(0.045, 0.45+(0:(ColumnSize-1)), adj=1,
       index[(base+1):(base+ColumnSize)], cex=0.6,
       col=TextContrastColor[(base+1):(base+ColumnSize)])
  text(0.06, 0.45+(0:(ColumnSize-1)), adj=0,
       colors()[(base+1):(base+ColumnSize)], cex=0.6,
       col=TextContrastColor[(base+1):(base+ColumnSize)])
  save <- par(family="mono")  # use mono-spaced font with number columns
  text(0.25, 0.45+(0:(ColumnSize-1)), adj=0,
       HexAndDec[(base+1):(base+ColumnSize)], cex=0.6,
       col=TextContrastColor[(base+1):(base+ColumnSize)])
  par(save)

  # Column 2
  if (remaining > PerColumn)
  {
    remaining <- remaining - PerColumn
    ColumnSize <- ifelse(remaining < PerColumn, remaining, PerColumn)
    rect(0.51, 0:(ColumnSize-1),
         1.00, 1:ColumnSize,
         border="black",
         col=colors()[(base+PerColumn+1):(base+PerColumn+ColumnSize)])
    text(0.545, 0.45+(0:(ColumnSize-1)), adj=1,
         index[(base+PerColumn+1):(base+PerColumn+ColumnSize)], cex=0.6,
         col=TextContrastColor[(base+PerColumn+1):(base+PerColumn+ColumnSize)])
    text(0.56, 0.45+(0:(ColumnSize-1)), adj=0,
         colors()[(base+PerColumn+1):(base+PerColumn+ColumnSize)], cex=0.6,
         col=TextContrastColor[(base+PerColumn+1):(base+PerColumn+ColumnSize)])
    save <- par(family="mono")
    text(0.75, 0.45+(0:(ColumnSize-1)), adj=0,
         HexAndDec[(base+PerColumn+1):(base+PerColumn+ColumnSize)], cex=0.6,
         col=TextContrastColor[(base+PerColumn+1):(base+PerColumn+ColumnSize)])
    par(save)
  }

}

par(oldparameters)
dev.off()

```


POR QUÉ ES IMPORTANTE CONSIDERAR LA CEGUERA AL COLOR
=====================================================

A propósito de daltonismo y heatmaps, mira comentarios en el foro de esa página (el más reciente primero, que es respuesta al segundo)
Sería interesante darle respuesta por frecuencia de variación en percep. color (el artículo del IEEE tenía los porcentajes)

Julio Fernández <http://eskup.elpais.com/juli0>

heber <http://eskup.elpais.com/C1412009164-b3defc80060c0a3a32fa0a1b8803d2eb/1412174451-120c5b04818bff4f681b6de84a271ff5>

Muchas gracias, esa sería una solución, pues la mayoría de daltónicos (en mi caso ausencia aguda de percepción de la frecuencia del verde) desarrollamos un sentido para diferenciar tonos en relación a su luminosidad, hasta el punto de que "coloreamos" lo que en realidad es gris (¿cuánto tiempo ha de pasar hasta que me de cuenta de que la película en la TV no es en color sino en B/N?). El cambiar los gráficos hacia colores visibles o B/N (jamás soy capaz de leer un gráfico con cólores) sería un detalle, por no hablar del tema de los semáforos (distintos tonos en distintas ciudades...) Foro EL PAÍS

Responder <javascript:void(0);>Más opciones <javascript:void(0);>
Seguir al usuario <javascript:void(0);>
01/10/2014, a las 16:40
avatar <http://eskup.elpais.com/glopllu>

Guillermo López <http://eskup.elpais.com/glopllu>

heber <http://eskup.elpais.com/C1412009164-b3defc80060c0a3a32fa0a1b8803d2eb/1412173041-45d715fa118fefc62185df50eeef8120>

Gracias por la explicación. Normalmente en ciencia se utiliza un código de colores común a lo que se conoce como la codificación semafórica donde verde significa poco, amarillo moderado y rojo peligroso. Por eso utilizan este tipo de codificación. Cierto es que a los daltónicos esa codificación no se les puede aplicar. Pero a los no daltónicos, los colores verde y rojo son los que mejor se distinguen entre sí por las características de las células de la retina.
