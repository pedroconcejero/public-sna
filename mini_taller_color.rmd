---
title: "mini-taller-color"
author: "pedro.concejerocerezo@telefonica.com"
date: "Monday, October 20, 2014"
output: html_document
---

OBJETIVOS DE ESTE DOCUMENTO
========================================================

Este documento es una parte de la documentación que estamos desarrollando para el talleR de coloR dentro de las jornadas R-hispano 2014:

http://r-es.org/item1151?structure=Comunidad&from=VI+Jornadas

Por un tema básico de tiempo y foco, este subconjunto evitará algunos de los aspectos más teóricos y se centrará en un ejemplo concreto aplicable a nuestro trabajo.

Dado que el taller está dirigido a la comunidad R, todo el código está en este lenguaje, aunque intentaremos que las recomendaciones sean suficientemente generales para cualquier lenguaje que permita manejar el color.

DOCUMENTACIÓN PREVIA
========================================================

DOCUMENTACIÓN DISPONIBLE EN INTERNET Y QUE USAREMOS EN EL TALLER

- Tabla completa de colores y nombres en R 
  <http://research.stowers-institute.org/efg/R/Color/Chart/ColorChart.pdf>
  
  obtenida a partir de esto:
  <http://research.stowers-institute.org/efg/R/Color/Chart/ColorChart.R>
  
- Using Color in R (ver "Los números del color")
  <http://research.stowers-institute.org/efg/Report/UsingColorInR.pdf>
  
- Color Brewer web site
  <http://colorbrewer2.org/>
  
- Color Scales, some further info
  <http://geog.uoregon.edu/datagraphics/color_scales.htm>
  
- Recopilación *completísima* de ciencia del color
  <http://www.efg2.com/Lab/Library/Color/Science.htm>
  
  y en concreto sobre "Color and Computers"
  
  <http://www.efg2.com/Lab/Library/Color/AndComputers.htm>
  
  e info general inc. ceguera al color ("daltonismo")
  
  <http://www.efg2.com/Lab/Library/Color/index.html>
  
- (*Mirar esto, es bueno pero incompleto*) http://www.stat.ubc.ca/~jenny/STAT545A/block14_colors.html

- Sobre ceguera al color:
  - <http://colororacle.org/design.html>

- Regla 6 "Use Color Effectively" de "Ten Simple Rules for Better Figures"
  - <http://www.ploscompbiol.org/article/info%3Adoi%2F10.1371%2Fjournal.pcbi.1003833#s7>
PREPARACIÓN DE ENTORNO R
==========================

```{r}

# Inicialización
# Comprueba si están y si no instala librerías

if ("sos" %in% row.names(installed.packages())  == FALSE) install.packages("sos", dependencies = T)
if ("colortools" %in% row.names(installed.packages())  == FALSE) install.packages("colortools", dependencies = T)
if ("dichromat" %in% row.names(installed.packages())  == FALSE) install.packages("dichromat", dependencies = T)

# Cargamos librerías que vamos a usar
library(colortools)
library(sos)
library(dichromat)

```


POR QUÉ R ES EL MEJOR SISTEMA ACTUAL (EN CAMPO ESTADÍSTICA) PARA MANEJO DE COLOR
========================================================

Veamos qué librerías contienen color (sos levanta una página html fuera de RStudio, con enlaces a la documentación de las funciones encontradas)


```{r}

sos::findFn("{color}")


```

Hay 359 funciones en 158 paquetes CRAN para estudiar o manejar color en R.

Tenemos por ejemplo la librería colorscience

<http://finzi.psych.upenn.edu/R/library/colorscience/html/00Index.html>

y la colortools
<http://gastonsanchez.com/colortools/>

"colortools is an R package designed to help users generate color schemes and color palettes. It provides a number of handy functions that will allow to select and play with *colors in an HSV (hue, saturation, value) color model*".

La librería colortools es fascinante. Por ejemplo, podemos hacer ruedas de color con un número variable de "gajos" o colores en la escala entre los extremos con la función wheel:

```{r}

colortools::wheel("blue", num = 6)

colortools::wheel("red", num = 12)

colortools::wheel("yellow", num = 24)

```

1. COLOR Y ENTORNO FÍSICO
============================

En la percepción del color, el entorno físico y dispositivo que genera el color son clave.

Muy importante:
- Luz emitida (p.ej. monitor LCD-TFT) vs. luz reflejada (p.ej., proyector)
- Color y contraste.

La función colortools::adjacent permite generar esquemas de color que están próximos unos a otros. 


```{r}

colortools::adjacent("blue")

colortools::adjacent("green")

colortools::adjacent("khaki")

```

2. LOS NÚMEROS DEL COLOR
==========================

Ver excelente presentación aquí:   <http://research.stowers-institute.org/efg/Report/UsingColorInR.pdf>

Nosotros utilizaremos el modelo de color HSV. En este modelo el color se puede representar "casi" como una circunferencia:
<http://www.handprint.com/HP/WCL/IMG/conesps3.gif>

Siempre podemos pasar de color RGB a color HSV

```{r}

rgb2hsv(col2rgb("blue"))


```


3. PERCEPCIÓN DEL COLOR - COLOR Y PSICOFÍSICA Y PSICOLOGÍA
=============================================================

¿Cómo percibimos ese atributo físico que es el color?
Antes de nada, ¿el color existe en la naturaleza? ¿Necesitamos el color para poder manejarnos en el mundo?

Para manejarnos en el mundo lo que necesitamos es contraste. El color *no* es necesario.
<http://en.wikipedia.org/wiki/Contrast_%28vision%29>

Funciones de sensibilidad al contraste en color:
<http://www.handprint.com/HP/WCL/IMG/conesens4.gif>

El color se construye:
*CONTRASTE DE COLOR*
*ILUSIONES DE COLOR*

Recomendaciones:
- Antes de fijar los colores en una visualización: maximizar el contraste -> elegir fondo!
- Color *no puede ser la única clave* (veremos más adelante razones adicionales)
  - Humanos somos relativamente malos para distinciones finas de color (matiz)
- No todos los colores se ven igual: recomendaciones sobre el azul en concreto
- Evitar que canales entre en conflicto. Efecto "cromoestereopsis"
  - <http://en.wikipedia.org/wiki/User:Karam91/Chromostereopsis>
  - <http://desdag.blogspot.com.es/2012/05/chromostereopsis-design-fails-due-to.html>
  - aunque ocasional y muy cuidadosamente se puede usar con beneficio
    <http://www.luminanze.com/writings/chromostereopsis_in_ux_design.html>
    
4. COLOR Y MEMORIA Y SEMÁNTICA
==============================

La memoria humana es relativamente bien conocida, y hay un principio muy bien establecido (muy a menudo demasiado simplificado) que describe la denominada "memoria a corto plazo", una especie de "buffer" de entrada a partir de los sentidos antes de que se le dé significado y se incorpore a procesos cognitivos de más alto nivel. Pues bien, esta memoria es muy limitada, hasta el punto de conocerse como la "el mágico número 7 +/- 2":

<http://en.wikipedia.org/wiki/The_Magical_Number_Seven,_Plus_or_Minus_Two>

<http://www.musanim.com/miller1956/>

<http://www.musanim.com/miller1956/fig6.gif>

La memoria visual humana es baja <http://en.wikipedia.org/wiki/Visual_memory#Short_term_visual_memory>, y es crucial dotar a los estímulos visuales de significado. El color, por su naturaleza cambiante y arbitraria, *no es la mejor clave visual*.

Veamos unos ejemplos y cómo manejar color, memoria y semántica. El manejo del color depende mucho del contexto natural y social de individuos, y esto se refleja en los nombres de que disponemos para los colores. Por ejemplo, los esquimales disponen de muchos nombres diferentes para matices de blanco que una persona viviendo más al sur será absolutamente incapaz de distinguir. Del mismo modo, grupos de nativos de la Amazonia disponen de multitud de términos para verde, mientras que no distinguen entre otros colores básicos como azul.

Tanto en español como en inglés, los nombres de color relacionado unívocamente con colores son los mismos 4: rojo, verde, azul y amarillo. Ademas de las tres variaciones acromáticas: blanco (todos los colores), negro (ningún color), y gris (mezcla de blanco y negro). Por tanto son estos 7 nombres el máximo que podremos usar sin que haya confusión sobre a qué color nos referimos.

Ejemplos de pocos colores opuestos (resultarán muy fáciles de recordar)


```{r}

colortools::complementary("blue")

colortools::complementary("red")

colortools::triadic("blue")

colortools::tetradic("yellow")

colortools::square("yellow")


```

Fijaos que estamos utilizando como máximo 4 colores básicos, con nombre unívocamente relacionado con el color. Será muy fácil localizar los colores en nuestra tabla de colores (<http://research.stowers-institute.org/efg/R/Color/Chart/ColorChart.pdf>).

Sin embargo, probad a mirar por un plazo muy breve de tiempo (10 seg. por ejemplo) los siguientes colores también opuestos en la rueda de "Hue", pero que son combinaciones d elos colores básicos. Probad a intentar recordarlos y buscarlos en la tabla:

```{r}

colortools::square("indianred3")

colortools::square("khaki")

```

Podemos ir incrementando la dificultad si nos alejamos de los colores básicos o añadimos matices, y por supuesto, si aumentamos el número de colores que hay que distinguir:


```{r}

colortools::wheel("darkseagreen", num = 6)

colortools::wheel("darkslateblue", num = 7)


```


Recomendaciones:

- *No utilizar color como única clave de categorización*
- Si no tenemos más remedio que categorizar elementos visuales con colores, y queremos hacer la tarea de reconocimiento y memoria lo más eficaz posible
  - Estaremos limitados por los 7 colores básicos con nombre unívoco.
  - En la medida de lo posible usaremos colores básicos (máxima saturación para un matiz -o max(S) para un H correspondiente a un color básico).
  - Incorporaremos *siempre* una leyenda asociando colores a significado. Idealmente, si tenemos espacio, incorporaremos *texto además de color*.
  - Además colocaremos la leyendo lo más próxima posible al gráfico al que sirve.
  
EJEMPLO APLICADO
==============================

```{r}

# Cargamos los datos
# Ojo pongo mi directorio de trabajo, tú pon el tuyo

setwd("C:/Users/pedroc/Desktop/madRid-R/talleres congreso R-hispano")

t <- read.table("tabla.txt", header = T, sep = "\t")

# Mínima modificación para que salgan bien las tablas

rownames(t) <- t[,1]

t <- t[,-1]

t <- as.table(as.matrix(t))

# Por defecto barplot usa escala de grises

barplot(t)

barplot(t, col=palette(),   legend = rownames(t))

# generemos un png para evitar problemas de ventanas RStudio

png(filename = "barplot_1.png",
    width = 1024,
    height = 768)

barplot(t, col=palette(),   
        legend = rownames(t),
        horiz = T)

dev.off()

```

Probemos RColorBrewer para tener una paleta más bonita.
Veamos primero todas las paletas que tenemos en RColorBrewer

```{r}

library(RColorBrewer)

display.brewer.all()

```

Seleccionemos una paleta que cumpla unos requisitos:
- que tenga cuantos más colores diferentes mejor
- que parta de colores con bajo contraste para permitir el máximo contraste con los objetos más pequeños

```{r}

cols <- brewer.pal(12,"Paired")

pizza(cols)

```

```{r}

png(filename = "barplot_2.png",
    width = 1024,
    height = 768,
    bg = "transparent")

barplot(t, col = cols,   
        legend = rownames(t),
        horiz = T,
        bg = "gray20")

dev.off()


```


La verdad es que todos estos intentos dan muy pocos frutos porque quizás el mecanismo de visualización no es el más adecuado.

Veamos otras posibilidades, entre ellas el mosaico.
La función básica es mosaic, pero no conseguimos lo que necesitamos (aunque permite manejar los NAs)


```{r}



mosaic(t,
       main = "ejemplo mosaico",
       color = cols, 
       cex=0.7, 
       las = 1,
       bg = "gray20")


```

mosaicplot es mucho mejor pero debemos pasar los NA  a 0

```{r}

t2 <- as.matrix(t)
  
t2[is.na(t2)] <- 0

t2 <- as.table(t(t2))

png(filename = "mosaic_def.png",
    width = 1024,
    height = 768,
    bg = "transparent")


mosaicplot(t2,
           main = "ejemplo mosaico",
           color = cols, 
           cex = 1, 
           las = 1)

dev.off()

```
